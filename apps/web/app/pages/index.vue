<script setup lang="ts">
const { $orpc, $authClient } = useNuxtApp()

const TITLE_TEXT = `CartiVault`;
const healthCheck = useQuery($orpc.healthCheck.queryOptions())
const serverUrl = useRuntimeConfig().public.serverURL
const session = $authClient.useSession()
</script>

<template>
  <UDashboardPanel id="dashboard" class="min-h-auto">
    <template #header>
      <UDashboardNavbar :title="TITLE_TEXT" :ui="{ right: 'gap-3' }">
        <template #leading>
          <UDashboardSidebarCollapse />
        </template>

        <template #right>
          <UColorModeButton />
        </template>
      </UDashboardNavbar>
    </template>

    <template #body>
      <UCard>
      <h2 class="mb-2 font-medium">API Status</h2>
        <div class="flex items-center gap-2">
          <div class="flex items-center gap-2">
            <div class="w-2 h-2 rounded-full" :class="{
              'bg-yellow-500 animate-pulse': healthCheck.status.value === 'pending',
              'bg-green-500': healthCheck.status.value === 'success',
              'bg-red-500': healthCheck.status.value === 'error',
              'bg-gray-400': healthCheck.status.value !== 'pending' &&
                healthCheck.status.value !== 'success' &&
                healthCheck.status.value !== 'error'
            }"></div>
            <span class="text-sm text-muted-foreground">
              <template v-if="healthCheck.status.value === 'pending'">
                Checking...
              </template>
              <template v-else-if="healthCheck.status.value === 'success'">
                Connected ({{ healthCheck.data.value }})
              </template>
              <template v-else-if="healthCheck.status.value === 'error'">
                Error: {{ healthCheck.error.value?.message || 'Failed to connect' }}
              </template>
              <template v-else>
                Idle
              </template>
            </span>
          </div>
          <span>{{ serverUrl }}</span>
        </div>
        <pre class="overflow-x-auto font-mono text-sm whitespace-pre-wrap">{{ session }}</pre>
      </UCard>
    </template>
  </UDashboardPanel>
</template>
